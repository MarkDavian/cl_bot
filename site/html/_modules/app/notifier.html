<!DOCTYPE html>

<html lang="ru" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>app.notifier &#8212; –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è CL Bot 2.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=0eddcf85"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=cd1d70c9"></script>
    <link rel="index" title="–ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å" href="../../genindex.html" />
    <link rel="search" title="–ü–æ–∏—Å–∫" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ app.notifier</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">–ú–æ–¥—É–ª—å —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è CL Bot.</span>

<span class="sd">–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
<span class="sd">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏. –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, </span>
<span class="sd">—Ç–∞–∫–∏–µ –∫–∞–∫ –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∫–Ω–∏–∂–µ–∫,</span>
<span class="sd">–∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–æ—Ñ–µ–º–∞—à–∏–Ω.</span>

<span class="sd">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Å—Ç—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ 9:00),</span>
<span class="sd">—á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</span>
<span class="sd">–≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">aiogram</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bot</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">config</span><span class="w"> </span><span class="kn">import</span> <span class="n">SETTINGS</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">app.core.funcs.app</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_app</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.notifier.check_birthday</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_birthday</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.notifier.check_lmk</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_lmk</span><span class="p">,</span> <span class="n">check_exp_lmk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.notifier.check_anniversary</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_anniversary</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.notifier.check_certs</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_certs</span><span class="p">,</span> <span class="n">check_exp_certs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.notifier.check_espresso_machines</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_espresso_machines</span><span class="p">,</span> <span class="n">format_notification_message</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.core.funcs.user</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_all_to_notify</span>

<span class="c1"># –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</span>
<span class="n">pending_notifications</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;birthday&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;lmk&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;certificates&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;anniversary&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;espresso&#39;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="c1"># –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –¥–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
<span class="n">last_notification_day</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="send_message">
<a class="viewcode-back" href="../../modules/notifier/index.html#app.notifier.send_message">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="n">chat_id</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ Telegram API.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        chat_id (int): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —á–∞—Ç–∞, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
<span class="sd">        text (str): –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bot</span> <span class="o">=</span> <span class="n">Bot</span><span class="p">(</span><span class="n">SETTINGS</span><span class="o">.</span><span class="n">BOT_TOKEN</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
        <span class="n">chat_id</span><span class="o">=</span><span class="n">chat_id</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span>
    <span class="p">)</span>
    <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="is_notification_time">
<a class="viewcode-back" href="../../modules/notifier/index.html#app.notifier.is_notification_time">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_notification_time</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤—Ä–µ–º–µ–Ω–µ–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.</span>
<span class="sd">    </span>
<span class="sd">    –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π,</span>
<span class="sd">    –¥–æ–ø—É—Å–∫–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å –≤ ¬±2 –º–∏–Ω—É—Ç—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True –µ—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–∫–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏,</span>
<span class="sd">              False –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">get_app</span><span class="p">()</span>
    <span class="n">notify_time</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">time_to_notify</span>
    
    <span class="c1"># –†–∞–∑–±–∏—Ä–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (—Ñ–æ—Ä–º–∞—Ç &#39;9:00&#39;)</span>
    <span class="n">notify_hour</span><span class="p">,</span> <span class="n">notify_minute</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">notify_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))</span>
    
    <span class="c1"># –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">current_hour</span><span class="p">,</span> <span class="n">current_minute</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">minute</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">current_hour</span><span class="p">,</span> <span class="n">current_minute</span><span class="p">,</span> <span class="n">notify_hour</span><span class="p">,</span> <span class="n">notify_minute</span><span class="p">)</span>
    
    <span class="c1"># –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç—ã —Å –Ω–∞—á–∞–ª–∞ –¥–Ω—è –¥–ª—è –æ–±–æ–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π</span>
    <span class="n">current_time_minutes</span> <span class="o">=</span> <span class="n">current_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">current_minute</span>
    <span class="n">notify_time_minutes</span> <span class="o">=</span> <span class="n">notify_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">notify_minute</span>
    
    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –æ–∫–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (¬±2 –º–∏–Ω—É—Ç—ã)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_time_minutes</span> <span class="o">-</span> <span class="n">notify_time_minutes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span></div>



<div class="viewcode-block" id="should_send_missed_notifications">
<a class="viewcode-back" href="../../modules/notifier/index.html#app.notifier.should_send_missed_notifications">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">should_send_missed_notifications</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.</span>
<span class="sd">    </span>
<span class="sd">    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–µ –±—ã–ª–æ –ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω–æ</span>
<span class="sd">    –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –±–æ—Ç </span>
<span class="sd">    –±—ã–ª –≤—ã–∫–ª—é—á–µ–Ω –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏).</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True –µ—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –∏ </span>
<span class="sd">              —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è —É–∂–µ –ø—Ä–æ—à–ª–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏,</span>
<span class="sd">              False –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">last_notification_day</span>
    
    <span class="c1"># –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">current_day</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">day</span>
    
    <span class="c1"># –†–∞–∑–±–∏—Ä–∞–µ–º –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">get_app</span><span class="p">()</span>
    <span class="n">notify_time</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">time_to_notify</span>
    <span class="n">notify_hour</span><span class="p">,</span> <span class="n">notify_minute</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">notify_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))</span>
    
    <span class="c1"># –ï—Å–ª–∏ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–∂–µ –ø—Ä–æ—à–ª–æ —Å–µ–≥–æ–¥–Ω—è –∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ —Å–µ–≥–æ–¥–Ω—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
    <span class="n">current_time_minutes</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">now</span><span class="o">.</span><span class="n">minute</span>
    <span class="n">notify_time_minutes</span> <span class="o">=</span> <span class="n">notify_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">notify_minute</span>
    
    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º: </span>
    <span class="c1"># 1. –ï—Å–ª–∏ –¥–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º –¥–Ω–µ–º (–∏–ª–∏ None)</span>
    <span class="c1"># 2. –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">last_notification_day</span> <span class="o">!=</span> <span class="n">current_day</span> <span class="ow">and</span> 
            <span class="n">current_time_minutes</span> <span class="o">&gt;</span> <span class="n">notify_time_minutes</span><span class="p">)</span></div>



<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__dr_notifier</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</span>
<span class="sd">    </span>
<span class="sd">    –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö</span>
<span class="sd">    –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ç–µ–º –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">check_birthday</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dr</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;üéÇ –í –±–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏ –î–Ω–∏ –†–æ–∂–¥–µ–Ω–∏—è —É —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">dr</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">employee</span><span class="o">.</span><span class="n">get_days_to_birth</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - –∑–∞–≤—Ç—Ä–∞ –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è! –£—Ä–∞!</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>   
                    <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - —á–µ—Ä–µ–∑ </span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">get_days_to_birth</span><span class="p">()</span><span class="si">}</span><span class="s2"> –¥–Ω–µ–π</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</span>
            <span class="n">pending_notifications</span><span class="p">[</span><span class="s1">&#39;birthday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">message</span><span class="p">,</span> <span class="n">get_all_to_notify</span><span class="p">())]</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">get_app</span><span class="p">()</span><span class="o">.</span><span class="n">dr_notify_time_interval</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__lmk_notifier</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∫–Ω–∏–∂–µ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</span>
<span class="sd">    </span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∫ —É–∂–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ, —Ç–∞–∫ –∏ —Å–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞—é—â–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–Ω–∏–∂–∫–∏,</span>
<span class="sd">    —Ñ–æ—Ä–º–∏—Ä—É—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">lmk</span> <span class="o">=</span> <span class="n">check_lmk</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lmk</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω—ã –º–µ–¥. –∫–Ω–∏–∂–∫–∏ —É —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">lmk</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞ –º–µ–¥. –∫–Ω–∏–∂–∫–∞</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">lmk</span> <span class="o">=</span> <span class="n">check_exp_lmk</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lmk</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;‚ö†Ô∏è –í –±–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –õ–ú–ö —É —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">lmk</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - —á–µ—Ä–µ–∑ </span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">get_days_lmk</span><span class="p">()</span><span class="si">}</span><span class="s2"> –¥–Ω–µ–π</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">messages</span><span class="p">:</span>
            <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</span>
            <span class="n">pending_notifications</span><span class="p">[</span><span class="s1">&#39;lmk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">msg</span><span class="p">,</span> <span class="n">get_all_to_notify</span><span class="p">())</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">get_app</span><span class="p">()</span><span class="o">.</span><span class="n">lmk_notify_time_interval</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__certs_notifier</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.</span>
<span class="sd">    </span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∫ —É–∂–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ, —Ç–∞–∫ –∏ —Å–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞—é—â–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã </span>
<span class="sd">    —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, —Ñ–æ—Ä–º–∏—Ä—É—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">employees</span> <span class="o">=</span> <span class="n">check_certs</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">employees</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">employee</span><span class="p">,</span> <span class="n">cert_type</span> <span class="ow">in</span> <span class="n">employees</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - –ø—Ä–æ—Å—Ä–æ—á–µ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç </span><span class="si">{</span><span class="n">cert_type</span><span class="si">}</span><span class="s2"> –æ—Ç </span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">get_cert_by_type</span><span class="p">(</span><span class="n">cert_type</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">employees</span> <span class="o">=</span> <span class="n">check_exp_certs</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">employees</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;‚ö†Ô∏è –í –±–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —É —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">employee</span><span class="p">,</span> <span class="n">cert_type</span> <span class="ow">in</span> <span class="n">employees</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">cert_type</span><span class="si">}</span><span class="s2"> ‚Äì —á–µ—Ä–µ–∑ </span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">get_days_to_cert</span><span class="p">(</span><span class="n">cert_type</span><span class="p">)</span><span class="si">}</span><span class="s2"> –¥–Ω–µ–π</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">messages</span><span class="p">:</span>
            <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</span>
            <span class="n">pending_notifications</span><span class="p">[</span><span class="s1">&#39;certificates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">msg</span><span class="p">,</span> <span class="n">get_all_to_notify</span><span class="p">())</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">get_app</span><span class="p">()</span><span class="o">.</span><span class="n">certs_time_interval</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__anniversary_notifier</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è —é–±–∏–ª–µ–µ–≤ —Ä–∞–±–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</span>
<span class="sd">    </span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —é–±–∏–ª–µ–µ–≤ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç </span>
<span class="sd">    —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç–∞–∫–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">anniversary</span> <span class="o">=</span> <span class="n">check_anniversary</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">anniversary</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;üéâ –í –±–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏ —é–±–∏–ª–µ–∏ —É —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">anniversary</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - —á–µ—Ä–µ–∑ </span><span class="si">{</span><span class="n">employee</span><span class="o">.</span><span class="n">get_days_to_anniversary</span><span class="p">()</span><span class="si">}</span><span class="s2"> –¥–Ω–µ–π</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</span>
            <span class="n">pending_notifications</span><span class="p">[</span><span class="s1">&#39;anniversary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">message</span><span class="p">,</span> <span class="n">get_all_to_notify</span><span class="p">())]</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">get_app</span><span class="p">()</span><span class="o">.</span><span class="n">anniversary_time_interval</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__espresso_notifier</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ—Ñ–µ–º–∞—à–∏–Ω.</span>
<span class="sd">    </span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ </span>
<span class="sd">    –∑–∞–º–µ–Ω—ã —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–π –≤ –∫–æ—Ñ–µ–º–∞—à–∏–Ω–∞—Ö, —Ñ–æ—Ä–º–∏—Ä—É—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">machines</span> <span class="o">=</span> <span class="n">check_espresso_machines</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">machines</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">format_notification_message</span><span class="p">(</span><span class="n">machines</span><span class="p">)</span>
            
            <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</span>
            <span class="n">pending_notifications</span><span class="p">[</span><span class="s1">&#39;espresso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">message</span><span class="p">,</span> <span class="n">get_all_to_notify</span><span class="p">())]</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">86400</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__notification_sender</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.</span>
<span class="sd">    </span>
<span class="sd">    –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫—É –≤—Å–µ—Ö –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö</span>
<span class="sd">    —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–Ω—è.</span>
<span class="sd">    –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –±—ã–ª–∏ –ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
<span class="sd">    –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">last_notification_day</span>
    
    <span class="c1"># –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –ª–∏ –º—ã –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–µ–≥–æ–¥–Ω—è</span>
    <span class="k">if</span> <span class="n">should_send_missed_notifications</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ä–∞–∑—É...&quot;</span><span class="p">)</span>
        <span class="c1"># –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">notifications</span> <span class="ow">in</span> <span class="n">pending_notifications</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">message</span><span class="p">,</span> <span class="n">chat_ids</span> <span class="ow">in</span> <span class="n">notifications</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chat_id</span> <span class="ow">in</span> <span class="n">chat_ids</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">send_message</span><span class="p">(</span><span class="n">chat_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            
            <span class="c1"># –û—á–∏—â–∞–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
            <span class="n">pending_notifications</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
        <span class="n">last_notification_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">day</span>
    
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏—à–ª–æ –ª–∏ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">is_notification_time</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">is_notification_time</span><span class="p">():</span>
            <span class="c1"># –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
            <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">notifications</span> <span class="ow">in</span> <span class="n">pending_notifications</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">message</span><span class="p">,</span> <span class="n">chat_ids</span> <span class="ow">in</span> <span class="n">notifications</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">chat_id</span> <span class="ow">in</span> <span class="n">chat_ids</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">send_message</span><span class="p">(</span><span class="n">chat_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                
                <span class="c1"># –û—á–∏—â–∞–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                <span class="n">pending_notifications</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1"># –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
            <span class="n">last_notification_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">day</span>
        
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_start_notifier</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.</span>
<span class="sd">    </span>
<span class="sd">    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç asyncio.gather –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π-notifier,</span>
<span class="sd">    —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">__dr_notifier</span><span class="p">(),</span>
        <span class="n">__lmk_notifier</span><span class="p">(),</span>
        <span class="n">__certs_notifier</span><span class="p">(),</span>
        <span class="n">__anniversary_notifier</span><span class="p">(),</span>
        <span class="n">__espresso_notifier</span><span class="p">(),</span>
        <span class="n">__notification_sender</span><span class="p">()</span>  <span class="c1"># –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</span>
    <span class="p">)</span>


<div class="viewcode-block" id="start_notifier">
<a class="viewcode-back" href="../../modules/notifier/index.html#app.notifier.start_notifier">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">start_notifier</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.</span>
<span class="sd">    </span>
<span class="sd">    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</span>
<span class="sd">    –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">_start_notifier</span><span class="p">())</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">CL Bot</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="–ò—Å–∫–∞—Ç—å" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
<p class="caption" role="heading"><span class="caption-text">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules/main.html">–ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/core/index.html">–ú–æ–¥—É–ª—å Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/telegram/index.html">–ú–æ–¥—É–ª—å Telegram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/notifier/index.html">–ú–æ–¥—É–ª—å Notifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/backup/index.html">–ú–æ–¥—É–ª—å Backup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/settings.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">–ö–æ–¥ –º–æ–¥—É–ª—è</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Mark Davian.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>