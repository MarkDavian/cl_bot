Хранение данных
================

Система хранения данных в приложении основана на JSON-файлах, расположенных в директории ``storage``. 
Каждый файл отвечает за хранение определенного типа данных, что обеспечивает модульность 
и простоту поддержки приложения.

Структура хранилища
---------------------

Основные файлы хранилища:

* **storage.json** - данные о сотрудниках
* **app.json** - настройки приложения
* **users.json** - информация о пользователях бота
* **espresso_machines.json** - данные о кофемашинах
* **certificates/** - директория для хранения сертификатов

Формат данных о сотрудниках
----------------------------

Данные о сотрудниках хранятся в файле ``storage.json`` в следующем формате:

.. code-block:: json

    {
      "all": [
        {
          "name": "Иванов Иван",
          "birthday": "01.01.2003",
          "registration": "27.03.2025",
          "workstarted": "02.02.2022",
          "lmk": "03.03.2023",
          "id": "67e548s7b73h92319t9fa2c0",
          "cert_base": null,
          "cert_base_path": [],
          "cert_profi": null,
          "cert_profi_path": [],
          "test_results": []
        }
      ]
    }

Поля записи сотрудника:

* **name** - имя сотрудника
* **birthday** - дата рождения (формат ДД.ММ.ГГГГ)
* **registration** - дата регистрации в системе
* **workstarted** - дата начала работы
* **lmk** - дата окончания медицинской книжки
* **id** - уникальный идентификатор
* **cert_base** - дата сертификата базового уровня
* **cert_base_path** - пути к файлам сертификата базового уровня
* **cert_profi** - дата сертификата профессионального уровня
* **cert_profi_path** - пути к файлам сертификата профессионального уровня
* **test_results** - результаты тестирования

Настройки приложения
----------------------

Настройки хранятся в файле ``app.json`` в следующем формате:

.. code-block:: json

    {
      "password": "1234",
      "lmk_notify_time_interval": 86400,
      "dr_notify_time_interval": 86400,
      "anniversary_time_interval": 432000,
      "certs_time_interval": 172800,
      "time_to_notify": "9:00"
    }

Поля настроек:

* **password** - пароль для доступа к боту
* **lmk_notify_time_interval** - интервал уведомлений о медкнижках (в секундах)
* **dr_notify_time_interval** - интервал уведомлений о днях рождения (в секундах)
* **anniversary_time_interval** - интервал уведомлений о юбилеях (в секундах)
* **certs_time_interval** - интервал уведомлений о сертификатах (в секундах)
* **time_to_notify** - время отправки уведомлений (формат ЧЧ:ММ)

Данные о пользователях
------------------------

Информация о пользователях сохраняется в ``users.json`` в следующем формате:

.. code-block:: json

    {
      "all": [
        {
          "id": "123456789",
          "chat_notify": true,
          "registration": "01.01.2025",
          "role": "admin"
        }
      ]
    }

Поля пользователя:

* **id** - ID пользователя в Telegram
* **chat_notify** - флаг получения уведомлений
* **registration** - дата регистрации
* **role** - роль пользователя (admin, user)

Данные о кофемашинах
----------------------

Информация о кофемашинах хранится в ``espresso_machines.json`` в следующем формате:

.. code-block:: json

    {
      "all": [
        {
          "id": "67e548s7b73h92319t9fa2c0",
          "name": "Кофемашина 1",
          "model": "Model X",
          "service_date": "01.01.2025",
          "next_service_date": "01.04.2025"
        }
      ]
    }

Поля кофемашины:

* **id** - уникальный идентификатор
* **name** - название кофемашины
* **model** - модель
* **service_date** - дата последнего обслуживания
* **next_service_date** - дата следующего обслуживания

Принципы работы с хранилищем
------------------------------

Для работы с хранилищем используется класс ``Storage`` и его производные классы, 
которые предоставляют методы для чтения и записи данных.

Хранилище поддерживает следующие операции:

* Получение всех записей (метод ``get``)
* Добавление новой записи (метод ``add``)
* Обновление существующей записи (метод ``update``)
* Удаление записи (метод ``delete``)
* Массовое добавление записей (метод ``bulk_add``)

.. important::

   Все даты в хранилище используют формат ДД.ММ.ГГГГ для обеспечения
   единообразия и корректной работы функций сравнения и проверки дат.

.. warning::

   Прямое редактирование JSON-файлов не рекомендуется. Используйте
   предоставленные классы и методы для работы с данными.

.. automodule:: storage
   :members:
   :undoc-members:
   :show-inheritance:
